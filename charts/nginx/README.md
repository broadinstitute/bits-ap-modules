
Nginx
===========

A Helm chart for Kubernetes

## Requirements

* Kubernetes >= 1.14
* Helm >= 3.5.4

## Installing

### Install using Helm repository

* Add the BITS Helm charts repo and install the chart
```
helm repo add bits https://broadinstitute.github.io/bits-ap-modules
helm install nginx bits/nginx
```

## Private Github Repo

* To be able to pull from a private repo, [generate a read-only deploy key](https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys) and add it as a reader to the github repo.  You can at this point either manually create a kubernetes secret from these files.
```
kubectl create secret generic --namespace=example-site kubernetes.io/ssh-auth --from-file=ssh-privatekey=/path/to/key --from-file=ssh-publickey=/path/to/key.pub example-deploykey
```

* The deploy key secret must be in the format:
```
ssh-privatekey: <key>
ssh-publickey: <key>
```
OR you can pass the private key contents to helm when the chart is deployed on the kubernetes cluster.

## Configuration

The following table lists the configurable parameters of the Nginx chart and their default values.

| Parameter                | Description             | Default        |
| ------------------------ | ----------------------- | -------------- |
| `replicaCount` |  | `1` |
| `image.repository` |  | `"nginx"` |
| `image.pullPolicy` |  | `"IfNotPresent"` |
| `image.tag` |  | `""` |
| `imagePullSecrets` |  | `[]` |
| `nameOverride` |  | `""` |
| `fullnameOverride` |  | `""` |
| `content.enabled` |  | `true` |
| `content.SyncImage.repository` |  | `"us-central1-docker.pkg.dev/infra2-core/containers/github-sync"` |
| `content.SyncImage.tag` |  | `"latest"` |
| `content.git.deployKeySecret` |  | `""` |
| `content.git.deployKey` |  | `""` |
| `content.git.repository` |  | `"git@github.com:broadinstitute/potato-site.git"` |
| `content.git.branch` |  | `"main"` |
| `content.volume.size` |  | `"1Gi"` |
| `serviceAccount.create` |  | `false` |
| `serviceAccount.annotations` |  | `{}` |
| `serviceAccount.name` |  | `""` |
| `podAnnotations` |  | `{}` |
| `podSecurityContext` |  | `{}` |
| `securityContext` |  | `{}` |
| `service.type` |  | `"NodePort"` |
| `service.port` |  | `80` |
| `ingress.enabled` |  | `false` |
| `ingress.annotations` |  | `{}` |
| `ingress.hosts` |  | `[]` |
| `ingress.tls` |  | `[]` |
| `resources` |  | `{}` |
| `autoscaling.enabled` |  | `false` |
| `autoscaling.minReplicas` |  | `1` |
| `autoscaling.maxReplicas` |  | `100` |
| `autoscaling.targetCPUUtilizationPercentage` |  | `80` |
| `nodeSelector` |  | `{}` |
| `tolerations` |  | `[]` |
| `affinity` |  | `{}` |
| `livenessProbe.tcpSocket.port` |  | `80` |
| `livenessProbe.initialDelaySeconds` |  | `45` |
| `livenessProbe.periodSeconds` |  | `20` |
| `livenessProbe.timeoutSeconds` |  | `5` |
| `livenessProbe.failureThreshold` |  | `6` |
| `livenessProbe.successThreshold` |  | `1` |
| `readinessProbe.httpGet.path` |  | `"/"` |
| `readinessProbe.httpGet.port` |  | `"http"` |
| `readinessProbe.initialDelaySeconds` |  | `30` |
| `readinessProbe.periodSeconds` |  | `10` |
| `readinessProbe.timeoutSeconds` |  | `5` |
| `readinessProbe.failureThreshold` |  | `6` |
| `readinessProbe.successThreshold` |  | `1` |



---
_Documentation generated by [Frigate](https://frigate.readthedocs.io)._

